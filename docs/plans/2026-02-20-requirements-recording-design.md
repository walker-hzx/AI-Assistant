# 需求讨论实时记录功能设计

## 1. 背景与目标

- **问题描述**：长沟通过程中，确认的需求点容易被遗忘，新会话无法恢复之前的讨论上下文
- **期望结果**：在需求讨论过程中，实时记录所有确认的需求点，确保不被遗漏
- **成功标准**：
  - `/discuss` 触发时自动创建需求记录文档
  - 讨论中每确认一个需求点，自动追加到文档
  - 用户可随时查看已记录的需求
  - 新会话可读取之前的讨论记录继续

## 2. 功能设计

### 2.1 触发时机

| 触发条件 | 操作 |
|----------|------|
| `/discuss` 或 `/discuss <主题>` | 创建需求记录文档 |
| 用户明确一个新的需求点时 | 自动追加到当前文档 |
| 用户说"查看需求" | 展示当前文档内容 |

### 2.2 文档位置与命名

- **目录：`docs/requirements/`
- **命名格式**：`YYYY-MM-DD-<主题>-**需求.md`
- 如果 → `YYYY-MM-DD-用户没提供主题需求讨论.md`

### 2.3 文档结构

```markdown
# 需求讨论：<主题>

> 创建时间：2026-02-20 10:00

## 确认的需求点

### 10:30 - 第 1 轮
- 需求点 1
- 需求点 2

### 10:45 - 第 2 轮
- 需求点 3

## 待确认
- [ ] 问题 1
- [ ] 问题 2

## 讨论进度
- 当前阶段：探索功能细节
- 上次讨论位置：...
```

### 2.4 实时记录策略

| 场景 | 记录方式 |
|------|----------|
| 用户回答一个问题 | 记录用户回答的要点 |
| 确认一个需求点 | 追加到"确认的需求点" |
| 产生一个新问题 | 追加到"待确认"列表 |
| 用户纠正理解错误 | 更新对应内容，标注"修正" |
| 讨论结束 | 更新文档状态 |

### 2.5 与现有流程集成

```
/discuss → 创建文档 → discuss-requirements skill → 记录内容
    ↓
/interaction → 继续记录 → describe-interaction skill → 记录内容
    ↓
/plan → 生成计划 → writing-plans skill → 追加计划到文档
```

## 3. 用户交互

### 3.1 查看需求

- 用户说"查看当前需求" → 读取并展示文档
- 用户说"我之前的需求是xxx" → 搜索并加载对应文档

### 3.2 继续讨论

- 新会话开始时，自动检测是否有未完成的需求文档
- 询问用户是否继续之前的讨论

## 4. 技术实现

### 4.1 修改的 Skills

| Skill | 修改内容 |
|-------|----------|
| `discuss-requirements` | 添加自动记录逻辑 |
| `describe-interaction` | 添加自动记录逻辑 |
| `writing-plans` | 追加计划到需求文档 |

### 4.2 新增 Command（可选）

```yaml
name: view-requirements
description: 查看当前需求讨论记录
```

## 5. 实施计划

### Phase 1: 基础功能
1. 修改 `discuss-requirements` skill，添加文档创建和记录逻辑
2. 定义需求文档模板
3. 测试基本流程

### Phase 2: 完善记录
1. 修改 `describe-interaction` skill，集成记录功能
2. 添加"查看需求"命令
3. 新会话恢复逻辑

### Phase 3: 优化体验
1. 修改 `writing-plans` skill，追加计划到需求文档
2. 添加讨论进度追踪
3. 整体测试和优化

## 6. 风险与边界

- **风险**：实时记录可能影响讨论流畅度
  - **缓解**：异步写入，不阻塞对话
- **边界**：用户主动说"不需要记录"时，跳过记录
